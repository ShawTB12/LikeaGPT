# OpenAI API セットアップガイド

## 🔐 セキュリティを重視したOpenAI API実装

このプロジェクトでは、データがOpenAIの学習に使用されないよう、セキュリティとプライバシーを最重要視した実装を行っています。

## 📋 必要な環境変数の設定

### 1. `.env.local` ファイルを作成

プロジェクトのルートディレクトリに `.env.local` ファイルを作成し、以下の内容を追加してください：

```bash
# OpenAI API Configuration
OPENAI_API_KEY=sk-your-openai-api-key-here

# セキュリティ設定
NEXT_PUBLIC_APP_ENV=production
```

### 2. OpenAI APIキーの取得

1. [OpenAI Platform](https://platform.openai.com/) にアクセス
2. アカウントでログイン
3. API Keys セクションで新しいAPIキーを作成
4. 作成されたキーを`.env.local`ファイルに設定

## 🛡️ セキュリティ機能

### データ学習防止
- **デフォルト設定**: OpenAI APIでは、デフォルトでAPIを通じて送信されたデータは学習に使用されません
- **匿名性の保持**: ユーザーIDを明示的に設定せず、匿名性を保持
- **適切なモデル選択**: `gpt-4o-mini`を使用（効率的で学習に使用されない）

### サーバーサイド処理
- **APIキーの保護**: APIキーはサーバーサイドのみで処理し、クライアントに露出させません
- **入力バリデーション**: 有害なコンテンツやセキュリティ関連の情報をフィルタリング
- **文字数制限**: メッセージは4000文字以内に制限

### エラーハンドリング
- **適切なエラーメッセージ**: セキュリティ情報を含まないエラーメッセージ
- **レート制限の処理**: API呼び出し制限への適切な対応
- **ログ記録**: サーバーサイドでのエラーログ（APIキーなどの機密情報は除外）

## 🚀 アプリケーションの起動

### 1. 依存関係のインストール
```bash
npm install
```

### 2. 開発サーバーの起動
```bash
npm run dev
```

### 3. ブラウザでアクセス
http://localhost:3000 にアクセスしてアプリケーションを確認

## ⚙️ 設定オプション

### モデル設定
現在の設定: `gpt-4o-mini`
- 効率的で高品質な応答
- コスト効率が良い
- データ学習に使用されない

### APIパラメータ
- `max_tokens`: 1000 (応答の最大長)
- `temperature`: 0.7 (創造性とバランス)
- 適切なシステムプロンプト（日本語対応、セキュリティ重視）

## 🔧 カスタマイズ

### システムプロンプトの変更
`app/api/chat/route.ts` の system メッセージを編集してAIの振る舞いをカスタマイズできます。

### セキュリティフィルターの追加
`harmfulPatterns` 配列に新しいパターンを追加して、フィルタリングを強化できます。

## 📝 重要な注意事項

1. **APIキーの保護**
   - `.env.local` ファイルをGitにコミットしないでください
   - APIキーを第三者と共有しないでください

2. **データプライバシー**
   - 個人情報や機密情報をチャットで送信しないでください
   - 実装されたフィルタリングに加えて、ユーザー側でも注意してください

3. **コスト管理**
   - OpenAI APIは従量制です
   - 使用量を定期的に確認してください

## 🆘 トラブルシューティング

### よくある問題

**Q: "APIキーが設定されていません" エラー**
A: `.env.local` ファイルが正しく作成され、`OPENAI_API_KEY` が設定されているか確認してください。

**Q: "insufficient_quota" エラー**
A: OpenAI アカウントのクレジットが不足しています。プラットフォームで残高を確認してください。

**Q: チャットの応答が遅い**
A: ネットワーク状況やOpenAI APIの負荷によります。しばらく待ってから再試行してください。

## 📞 サポート

技術的な問題がある場合は、以下を確認してください：
1. 開発者コンソールのエラーメッセージ
2. サーバーのログ
3. 環境変数の設定
4. OpenAI APIの利用状況 